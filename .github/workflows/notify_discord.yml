# .github/workflows/webhook_style_notify.yml

name: Webhook-style Discord notification

on:
  push:
    branches:
      - e72
jobs:
  discord-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord embed-style message
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_E72 }}
          REPO: ${{ github.repository }}
          BRANCH: ${{ github.ref_name }}
          AUTHOR: ${{ github.event.head_commit.author.name }}
          COMMIT_MSG: ${{ github.event.head_commit.message }}
          COMMIT_URL: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
          AVATAR_URL: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
        run: |
          curl -X POST -H "Content-Type: application/json" \
               -d @- "$DISCORD_WEBHOOK_E72" <<EOF
          {
            "username": "GitHub",
            "avatar_url": "${AVATAR_URL}",
            "embeds": [{
              "title": "Push to ${BRANCH}",
              "url": "${COMMIT_URL}",
              "description": "${COMMIT_MSG}",
              "color": 7506394,
              "author": {
                "name": "${AUTHOR}",
                "url": "https://github.com/${AUTHOR}"
              },
              "footer": {
                "text": "${REPO}"
              },
              "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
            }]
          }
EOF
